<!DOCTYPE html>
<html lang="ja">
<head>
    <meta charset="UTF-8">
    <title>図形を探せ ！Free</title>
    <style>
        body { text-align: center; font-family: 'Arial Black', sans-serif; background: #1a1a1a; color: white; margin: 0; overflow: hidden; }
        .header { background: #333; padding: 15px; border-bottom: 4px solid #555; height: 80px; }
        #game-board { position: relative; width: 95vw; height: calc(100vh - 180px); margin: 10px auto; background: #222; border-radius: 10px; display: none; }
        
        #start-screen { position: fixed; top: 0; left: 0; width: 100%; height: 100%; background: rgba(0,0,0,0.9); display: flex; flex-direction: column; align-items: center; justify-content: center; z-index: 100; }
        .start-btn { padding: 20px 50px; font-size: 30px; background: #2ed573; color: white; border: none; border-radius: 50px; cursor: pointer; transition: 0.2s; }
        .start-btn:hover { background: #7bed9f; transform: scale(1.1); }

        .shape { position: absolute; cursor: pointer; transition: transform 0.1s; }
        .target-symbol { display: inline-block; vertical-align: middle; width: 40px; height: 40px; }
        #timer { color: #ffffff; font-size: 30px; } /* 時間は見やすく白に */

        /* 間違えた時のアニメーション */
        @keyframes shake {
            0% { transform: translateX(0); }
            25% { transform: translateX(5px); }
            50% { transform: translateX(-5px); }
            75% { transform: translateX(5px); }
            100% { transform: translateX(0); }
        }
        .shake-ani { animation: shake 0.3s; }

        /* 図形のスタイル */
        .circle { border-radius: 50%; }
        .square { width: 45px; height: 45px; }
        .rect { width: 65px !important; height: 35px !important; }
        .hexagon { clip-path: polygon(25% 0%, 75% 0%, 100% 50%, 75% 100%, 25% 100%, 0% 50%); }
        .star { clip-path: polygon(50% 0%, 61% 35%, 98% 35%, 68% 57%, 79% 91%, 50% 70%, 21% 91%, 32% 57%, 2% 35%, 39% 35%); }
        .diamond { transform: rotate(45deg); width: 35px; height: 35px; }
        .triangle { width: 0 !important; height: 0 !important; background: transparent !important; }
    </style>
</head>
<body>

<div id="start-screen">
    <h1>図形を探せ！</h1>
    <p>お手つきしても大丈夫！たくさん見つけよう</p>
    <button class="start-btn" onclick="startGame()">ゲームスタート！</button>
</div>

<div class="header">
    <div id="target-box">さがせ！：<div id="target-ui" class="target-symbol"></div></div>
    <div>Time: <span id="timer">30</span> | Level: <span id="level">1</span></div>
</div>

<div id="game-board"></div>

<script>
    const board = document.getElementById('game-board');
    const startScreen = document.getElementById('start-screen');
    const targetUI = document.getElementById('target-ui');
    const timerEl = document.getElementById('timer');
    const levelEl = document.getElementById('level');

    const shapeConfigs = [
        { id: 'circle', color: '#FF4757' },
        { id: 'square', color: '#1E90FF' },
        { id: 'rect', color: '#2ED573' },
        { id: 'triangle', color: '#ECCC68' },
        { id: 'star', color: '#FF7F50' },
        { id: 'diamond', color: '#A29BFE' },
        { id: 'hexagon', color: '#747D8C' }
    ];

    let timeLeft = 30;
    let level = 1;
    let gameActive = false;

    function startGame() {
        startScreen.style.display = 'none';
        board.style.display = 'block';
        gameActive = true;
        initLevel();
        const timerId = setInterval(() => {
            timeLeft--;
            timerEl.innerText = Math.max(0, timeLeft);
            if (timeLeft <= 0) {
                gameActive = false;
                clearInterval(timerId);
                alert("おしまい！ 見つけた数（レベル）: " + (level - 1));
                location.reload();
            }
        }, 1000);
    }

    function initLevel() {
        board.innerHTML = '';
        const correct = shapeConfigs[Math.floor(Math.random() * shapeConfigs.length)];
        updateTargetUI(correct);

        const count = 30 + (level * 5); 
        createShape(correct, true);

        for (let i = 0; i < count; i++) {
            let wrong;
            do {
                wrong = shapeConfigs[Math.floor(Math.random() * shapeConfigs.length)];
            } while (wrong.id === correct.id); 
            createShape(wrong, false);
        }
    }

    function createShape(config, isCorrect) {
        const div = document.createElement('div');
        div.className = `shape ${config.id}`;
        
        div.style.left = Math.random() * (board.clientWidth - 80) + 'px';
        div.style.top = Math.random() * (board.clientHeight - 80) + 'px';
        
        if (config.id === 'triangle') {
            div.style.borderLeft = '22px solid transparent';
            div.style.borderRight = '22px solid transparent';
            div.style.borderBottom = `45px solid ${config.color}`;
        } else {
            div.style.backgroundColor = config.color;
            if (config.id !== 'rect' && config.id !== 'diamond') {
                div.style.width = '45px';
                div.style.height = '45px';
            }
        }

        div.onclick = () => {
            if (!gameActive) return;
            if (isCorrect) {
                level++;
                levelEl.innerText = level;
                initLevel();
            } else {
                // ペナルティなし。代わりに「プルプル」させる
                div.classList.add('shake-ani');
                setTimeout(() => div.classList.remove('shake-ani'), 300);
            }
        };
        board.appendChild(div);
    }

    function updateTargetUI(config) {
        targetUI.className = `target-symbol ${config.id}`;
        targetUI.style.backgroundColor = (config.id === 'triangle') ? 'transparent' : config.color;
        targetUI.style.borderBottom = (config.id === 'triangle') ? `40px solid ${config.color}` : 'none';
        targetUI.style.borderLeft = (config.id === 'triangle') ? '20px solid transparent' : 'none';
        targetUI.style.borderRight = (config.id === 'triangle') ? '20px solid transparent' : 'none';
    }
</script>
</body>
</html>
